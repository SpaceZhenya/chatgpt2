<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–ò-—á–∞—Ç (—Å –ø–∞–º—è—Ç—å—é)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f9; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; background: white; }
    .msg { margin: 5px 0; }
    .user { color: blue; }
    .bot { color: green; }
  </style>
</head>
<body>
  <h2>–ò–ò-—á–∞—Ç (Gemini 2.5 Flash + –ø–∞–º—è—Ç—å)</h2>
  <div id="chat"></div>
  <input id="input" type="text" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="width:80%">
  <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

  <script>
    const chat = document.getElementById('chat');
    const API_KEY = "AIzaSyCPJwayDaH4Lrb0fw8MypQYHP3xdr2KA9I"; // –≤—Å—Ç–∞–≤—å —Å–≤–æ–π –∫–ª—é—á Gemini
    const MODEL = "gemini-2.5-flash";

    // –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
    const history = [];

    function addMessage(sender, text) {
      const div = document.createElement('div');
      div.className = 'msg ' + sender;
      div.textContent = sender.toUpperCase() + ': ' + text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('input');
      const text = input.value.trim();
      if (!text) return;
      addMessage('user', text);

      // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
      history.push({ role: "user", parts: [{ text }] });
      input.value = '';

      addMessage('bot', "–î—É–º–∞—é...");

      try {
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              contents: history
            })
          }
        );

        const data = await response.json();
        console.log(data);

        const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "–ù–µ –ø–æ–Ω—è–ª ü§î";

        // –∑–∞–º–µ–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π "–¥—É–º–∞—é..." –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        chat.lastChild.textContent = "BOT: " + reply;

        // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
        history.push({ role: "model", parts: [{ text: reply }] });

      } catch (err) {
        chat.lastChild.textContent = "BOT: –û—à–∏–±–∫–∞ (" + err.message + ")";
      }
    }
  </script>
</body>
</html>
