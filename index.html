<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Pingvi v7 ğŸ§ ĞŸĞµĞ²ĞµÑ†</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f9; }
  h2 { display:flex; align-items:center; }
  #chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; background: white; }
  .msg { margin: 10px 0; display:flex; align-items:flex-start; }
  .user { color: blue; }
  .bot { color: green; }
  .penguin { font-size: 50px; margin-right:10px; transition: transform 0.3s; }
  .wave { transform: rotate(20deg); }
  .text { max-width: 80%; }
  #controls { margin-top: 10px; }
</style>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<h2>Pingvi v7 ğŸ§ ĞŸĞµĞ²ĞµÑ†</h2>
<div id="chat"></div>

<div id="controls">
  <input id="input" type="text" placeholder="ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ..." style="width:50%">
  <button onclick="sendMessage()">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
  <button onclick="resetChat()">Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ</button>
  <br><br>
  <label>Ğ ĞµĞ¶Ğ¸Ğ¼ Pingvi:</label>
  <select id="modeSelect">
    <option value="normal">ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹</option>
    <option value="joke">Ğ¨ÑƒÑ‚Ğ»Ğ¸Ğ²Ñ‹Ğ¹ ğŸ²</option>
    <option value="teacher">Ğ£Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒ ğŸ‘¨â€ğŸ«</option>
    <option value="philosopher">Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„ ğŸ¤”</option>
    <option value="motivator">ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ°Ñ‚Ğ¾Ñ€ ğŸ’ª</option>
    <option value="historian">Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ğº ğŸ“œ</option>
    <option value="poet">ĞŸĞ¾ÑÑ‚ âœ’ï¸</option>
    <option value="gamer">Ğ“ĞµĞ¹Ğ¼ĞµÑ€ ğŸ®</option>
    <option value="scientist">Ğ£Ñ‡Ñ‘Ğ½Ñ‹Ğ¹ ğŸ”¬</option>
    <option value="chef">Ğ¨ĞµÑ„-Ğ¿Ğ¾Ğ²Ğ°Ñ€ ğŸ‘¨â€ğŸ³</option>
    <option value="singer">ĞŸĞµĞ²ĞµÑ† ğŸ¤</option>
  </select>
  <br><br>
  <label>Ğ“Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚ÑŒ Ğ³Ğ¾Ğ»Ğ¾ÑĞ°: <span id="volLabel">50</span>%</label>
  <input type="range" id="volumeSlider" min="0" max="100" value="50">
</div>

<script>
const chat = document.getElementById('chat');
const input = document.getElementById('input');
const volumeSlider = document.getElementById('volumeSlider');
const volLabel = document.getElementById('volLabel');
const modeSelect = document.getElementById('modeSelect');

const API_KEY = "AIzaSyCPJwayDaH4Lrb0fw8MypQYHP3xdr2KA9I";
const MODEL = "gemini-2.5-flash";
let history = [];
let volume = 0.5;

// ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚Ğ¸
volumeSlider.addEventListener('input', () => {
  volume = volumeSlider.value / 100;
  volLabel.textContent = volumeSlider.value;
});

// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
function addMessage(sender, text, markdown=false) {
  const div = document.createElement('div');
  div.className = 'msg ' + sender;

  if(sender === 'bot') {
    const penguin = document.createElement('span');
    penguin.className = 'penguin';
    penguin.textContent = 'ğŸ§';
    div.appendChild(penguin);
    penguin.classList.add('wave');
    setTimeout(()=>penguin.classList.remove('wave'),500);
  }

  const span = document.createElement('div');
  span.className = 'text markdown';
  span.innerHTML = markdown ? marked.parse(text) : text;
  div.appendChild(span);

  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return div;
}

// Ğ¡Ğ±Ñ€Ğ¾Ñ
function resetChat() {
  history = [];
  chat.innerHTML = "";
  addMessage("bot", "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! Ğ¯ Pingvi ğŸ§. Ğ”Ğ°Ğ²Ğ°Ğ¹ Ğ¿Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ğ¼!", true);
}

// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñƒ
function getSystemInstruction() {
  switch(modeSelect.value) {
    case "joke": return "ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ²ĞµÑĞµĞ»Ğ¾, ÑˆÑƒÑ‚Ğ¸, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑĞ¼Ğ°Ğ¹Ğ»Ñ‹.";
    case "teacher": return "ĞĞ±ÑŠÑÑĞ½ÑĞ¹ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾ Ğ¸ Ğ¿Ğ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ¾, Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹.";
    case "philosopher": return "ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾ Ğ¸ Ğ¼ÑƒĞ´Ñ€Ğ¾.";
    case "motivator": return "Ğ‘ÑƒĞ´ÑŒ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼: Ğ²Ğ´Ğ¾Ñ…Ğ½Ğ¾Ğ²Ğ»ÑĞ¹ Ğ¸ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ğ¹.";
    case "historian": return "Ğ Ğ°ÑÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ ĞºĞ°Ğº Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğº Ñ Ñ„Ğ°ĞºÑ‚Ğ°Ğ¼Ğ¸ Ğ¸ Ğ´Ğ°Ñ‚Ğ°Ğ¼Ğ¸.";
    case "poet": return "ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¾, ÑÑ‚Ğ¸Ñ…Ğ°Ğ¼Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾.";
    case "gamer": return "Ğ“Ğ¾Ğ²Ğ¾Ñ€Ğ¸ ĞºĞ°Ğº Ğ³ĞµĞ¹Ğ¼ĞµÑ€, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ»ĞµĞ½Ğ³.";
    case "scientist": return "ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ ĞºĞ°Ğº ÑƒÑ‡Ñ‘Ğ½Ñ‹Ğ¹, Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¸ Ñ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ¼Ğ¸.";
    case "chef": return "Ğ”Ğ°Ğ²Ğ°Ğ¹ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¸ Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ñ‹ ĞºĞ°Ğº ÑˆĞµÑ„-Ğ¿Ğ¾Ğ²Ğ°Ñ€.";
    case "singer": return "ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ ĞºĞ°Ğº Ğ¿ĞµĞ²ĞµÑ†, ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ¿ĞµÑĞµĞ½ Ğ¸ Ğ¼ĞµĞ»Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸.";
    default: return "ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ¾ Ğ¸ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ğ¾.";
  }
}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Â«Ğ¿ĞµĞ½Ğ¸ĞµÂ» Ñ‚ĞµĞºÑÑ‚Ğ°
function singText(text) {
  const lines = text.split("\n");
  lines.forEach((line, index) => {
    const utterance = new SpeechSynthesisUtterance(line);
    utterance.lang = "ru-RU";
    utterance.volume = volume;
    utterance.rate = 1 + Math.random()*0.2;
    utterance.pitch = 1 + Math.random()*0.5;
    setTimeout(() => speechSynthesis.speak(utterance), index * 1200);
  });
}

// ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
async function sendMessage() {
  const text = input.value.trim();
  if(!text) return;

  addMessage('user', text);
  history.push({ role:"user", parts:[{text}] });
  input.value='';

  const botDiv = addMessage('bot', "Pingvi Ğ´ÑƒĞ¼Ğ°ĞµÑ‚...");

  try {
    const body = {
      contents: history,
      systemInstruction: { parts:[{text:getSystemInstruction()}] }
    };

    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
      { method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify(body) }
    );

    const data = await response.json();
    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "ĞĞµ Ğ¿Ğ¾Ğ½ÑĞ» ğŸ¤”";

    botDiv.remove();
    addMessage("bot", reply, true);
    history.push({ role:"model", parts:[{text:reply}] });

    // Ğ•ÑĞ»Ğ¸ Ñ€ĞµĞ¶Ğ¸Ğ¼ Â«ĞŸĞµĞ²ĞµÑ†Â», Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ singText
    if(modeSelect.value==="singer") {
      singText(reply);
    } else {
      const utterance = new SpeechSynthesisUtterance(reply);
      utterance.lang="ru-RU";
      utterance.volume = volume;
      speechSynthesis.speak(utterance);
    }

  } catch(err) {
    botDiv.textContent = "Pingvi: ĞÑˆĞ¸Ğ±ĞºĞ° ("+err.message+")";
  }
}

// Enter Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
input.addEventListener("keydown", e=>{ if(e.key==="Enter") sendMessage(); });

// Ğ¡Ñ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ
resetChat();
</script>
</body>
</html>
